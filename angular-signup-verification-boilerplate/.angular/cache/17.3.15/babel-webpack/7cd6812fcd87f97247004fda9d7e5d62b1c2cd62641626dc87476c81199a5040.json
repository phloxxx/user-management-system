{"ast":null,"code":"import { forkJoin, of } from 'rxjs';\nimport { first, catchError } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@app/_services/employee.service\";\nimport * as i2 from \"@app/_services\";\nimport * as i3 from \"@app/_services/department.service\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"@angular/common\";\nconst _c0 = (a0, a1) => ({\n  \"bg-success\": a0,\n  \"bg-danger\": a1\n});\nfunction ListComponent_button_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 10);\n    i0.ɵɵlistener(\"click\", function ListComponent_button_5_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.add());\n    });\n    i0.ɵɵtext(1, \"Add Employee\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ListComponent_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 11);\n    i0.ɵɵelement(1, \"div\", 12);\n    i0.ɵɵelementStart(2, \"p\", 13);\n    i0.ɵɵtext(3, \"Loading data...\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction ListComponent_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 14)(1, \"p\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 10);\n    i0.ɵɵlistener(\"click\", function ListComponent_div_8_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.retry());\n    });\n    i0.ɵɵtext(4, \"Retry\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r1.error);\n  }\n}\nfunction ListComponent_div_9_button_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 17);\n    i0.ɵɵlistener(\"click\", function ListComponent_div_9_button_3_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.add());\n    });\n    i0.ɵɵtext(1, \"Add Employee\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ListComponent_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 15)(1, \"p\");\n    i0.ɵɵtext(2, \"No employees found. Please add an employee to get started.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, ListComponent_div_9_button_3_Template, 2, 0, \"button\", 16);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    let tmp_1_0;\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ((tmp_1_0 = ctx_r1.account()) == null ? null : tmp_1_0.role) === \"Admin\");\n  }\n}\nfunction ListComponent_div_10_tr_19_button_25_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 26);\n    i0.ɵɵlistener(\"click\", function ListComponent_div_10_tr_19_button_25_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const employee_r6 = i0.ɵɵnextContext().$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.delete(employee_r6.id));\n    });\n    i0.ɵɵtext(1, \"Delete\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ListComponent_div_10_tr_19_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\");\n    i0.ɵɵtext(10);\n    i0.ɵɵpipe(11, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"td\")(13, \"span\", 21);\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(15, \"td\")(16, \"div\", 22)(17, \"button\", 23);\n    i0.ɵɵlistener(\"click\", function ListComponent_div_10_tr_19_Template_button_click_17_listener() {\n      const employee_r6 = i0.ɵɵrestoreView(_r5).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.viewRequests(employee_r6.id));\n    });\n    i0.ɵɵtext(18, \"Requests\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"button\", 23);\n    i0.ɵɵlistener(\"click\", function ListComponent_div_10_tr_19_Template_button_click_19_listener() {\n      const employee_r6 = i0.ɵɵrestoreView(_r5).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.viewWorkflows(employee_r6.id));\n    });\n    i0.ɵɵtext(20, \"Workflows\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(21, \"button\", 24);\n    i0.ɵɵlistener(\"click\", function ListComponent_div_10_tr_19_Template_button_click_21_listener() {\n      const employee_r6 = i0.ɵɵrestoreView(_r5).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.transfer(employee_r6));\n    });\n    i0.ɵɵtext(22, \"Transfer\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"button\", 10);\n    i0.ɵɵlistener(\"click\", function ListComponent_div_10_tr_19_Template_button_click_23_listener() {\n      const employee_r6 = i0.ɵɵrestoreView(_r5).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.edit(employee_r6.id));\n    });\n    i0.ɵɵtext(24, \"Edit\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(25, ListComponent_div_10_tr_19_button_25_Template, 2, 0, \"button\", 25);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    let tmp_10_0;\n    const employee_r6 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(employee_r6.employeeId);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r1.getUserEmail(employee_r6.userId));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(employee_r6.position);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r1.getDepartmentName(employee_r6.departmentId));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(11, 8, employee_r6.hireDate, \"shortDate\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(11, _c0, employee_r6.status === \"Active\", employee_r6.status !== \"Active\"));\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(employee_r6.status);\n    i0.ɵɵadvance(11);\n    i0.ɵɵproperty(\"ngIf\", ((tmp_10_0 = ctx_r1.account()) == null ? null : tmp_10_0.role) === \"Admin\");\n  }\n}\nfunction ListComponent_div_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 18)(1, \"table\", 19)(2, \"thead\")(3, \"tr\")(4, \"th\");\n    i0.ɵɵtext(5, \"Employee ID\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"th\");\n    i0.ɵɵtext(7, \"User\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"th\");\n    i0.ɵɵtext(9, \"Position\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"th\");\n    i0.ɵɵtext(11, \"Department\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"th\");\n    i0.ɵɵtext(13, \"Hire Date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"th\");\n    i0.ɵɵtext(15, \"Status\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"th\");\n    i0.ɵɵtext(17, \"Actions\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(18, \"tbody\");\n    i0.ɵɵtemplate(19, ListComponent_div_10_tr_19_Template, 26, 14, \"tr\", 20);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(19);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.employees);\n  }\n}\nexport let ListComponent = /*#__PURE__*/(() => {\n  class ListComponent {\n    constructor(employeeService, accountService, departmentService, alertService, router) {\n      this.employeeService = employeeService;\n      this.accountService = accountService;\n      this.departmentService = departmentService;\n      this.alertService = alertService;\n      this.router = router;\n      this.employees = [];\n      this.users = [];\n      this.departments = [];\n      this.loading = false;\n      this.error = '';\n    }\n    ngOnInit() {\n      this.loading = true;\n      this.loadAllData();\n    }\n    // Load all necessary data from the API\n    loadAllData() {\n      // Load departments and users even if employees fail\n      forkJoin({\n        employees: this.employeeService.getAll().pipe(catchError(error => {\n          console.error('Error loading employees:', error);\n          this.error = 'Failed to load employees. Please try again.';\n          return of([]);\n        })),\n        users: this.accountService.getAll().pipe(catchError(error => {\n          console.error('Error loading users:', error);\n          return of([]);\n        })),\n        departments: this.departmentService.getAll().pipe(catchError(error => {\n          console.error('Error loading departments:', error);\n          return of([]);\n        }))\n      }).pipe(first()).subscribe({\n        next: data => {\n          this.employees = data.employees || [];\n          this.users = data.users || [];\n          this.departments = data.departments || [];\n          this.loading = false;\n          console.log('All data loaded successfully', {\n            employees: this.employees.length,\n            users: this.users.length,\n            departments: this.departments.length\n          });\n          // Clear error if we have successfully loaded employees\n          if (this.employees.length > 0) {\n            this.error = '';\n          }\n        },\n        error: error => {\n          this.error = 'Failed to load data. Please try again.';\n          this.alertService.error(this.error);\n          this.loading = false;\n          console.error('Error in forkJoin:', error);\n        }\n      });\n    }\n    fetchEmployees() {\n      this.loading = true;\n      this.employeeService.getAll().pipe(first()).subscribe({\n        next: employees => {\n          this.employees = employees;\n          this.loading = false;\n          this.error = '';\n        },\n        error: error => {\n          this.error = 'Failed to load employees';\n          this.alertService.error(this.error);\n          this.loading = false;\n          console.error('Error fetching employees:', error);\n        }\n      });\n    }\n    retry() {\n      this.error = '';\n      this.loadAllData();\n    }\n    account() {\n      return this.accountService.accountValue;\n    }\n    edit(id) {\n      this.router.navigate(['/admin/employees/edit', id]);\n    }\n    add() {\n      this.router.navigate(['/admin/employees/add']);\n    }\n    transfer(employee) {\n      this.router.navigate(['/admin/employees/transfer', employee.id]);\n    }\n    delete(id) {\n      if (confirm('Are you sure you want to delete this employee?')) {\n        this.employeeService.delete(id).pipe(first()).subscribe({\n          next: () => {\n            this.alertService.success('Employee deleted');\n            this.fetchEmployees();\n          },\n          error: error => {\n            console.error('Error deleting employee:', error);\n            this.alertService.error('Failed to delete employee');\n          }\n        });\n      }\n    }\n    getUserEmail(userId) {\n      if (!userId) {\n        return 'No User Assigned';\n      }\n      const userIdStr = userId.toString();\n      const user = this.users.find(x => x.id && x.id.toString() === userIdStr);\n      if (user) {\n        return user.email;\n      } else {\n        return `Unknown User (ID: ${userId})`;\n      }\n    }\n    getDepartmentName(departmentId) {\n      if (!departmentId) {\n        return 'No Department';\n      }\n      const deptIdNum = Number(departmentId);\n      const department = this.departments.find(x => Number(x.id) === deptIdNum);\n      if (department) {\n        return department.name;\n      } else {\n        return `Unknown Department (ID: ${departmentId})`;\n      }\n    }\n    viewWorkflows(id) {\n      // Navigate to workflows page for this employee\n      this.router.navigate(['/admin/workflows'], {\n        queryParams: {\n          employeeId: id\n        }\n      });\n    }\n    viewRequests(id) {\n      // Navigate to the requests page for this employee\n      this.router.navigate(['/admin/requests'], {\n        queryParams: {\n          employeeId: id\n        }\n      });\n    }\n    static {\n      this.ɵfac = function ListComponent_Factory(t) {\n        return new (t || ListComponent)(i0.ɵɵdirectiveInject(i1.EmployeeService), i0.ɵɵdirectiveInject(i2.AccountService), i0.ɵɵdirectiveInject(i3.DepartmentService), i0.ɵɵdirectiveInject(i2.AlertService), i0.ɵɵdirectiveInject(i4.Router));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ListComponent,\n        selectors: [[\"app-list\"]],\n        decls: 11,\n        vars: 5,\n        consts: [[1, \"card\"], [1, \"card-header\"], [1, \"d-flex\", \"justify-content-between\", \"align-items-center\"], [1, \"mb-0\"], [\"class\", \"btn btn-sm btn-primary\", 3, \"click\", 4, \"ngIf\"], [1, \"card-body\"], [\"class\", \"text-center my-3\", 4, \"ngIf\"], [\"class\", \"alert alert-danger\", 4, \"ngIf\"], [\"class\", \"alert alert-info text-center\", 4, \"ngIf\"], [\"class\", \"table-responsive\", 4, \"ngIf\"], [1, \"btn\", \"btn-sm\", \"btn-primary\", 3, \"click\"], [1, \"text-center\", \"my-3\"], [\"role\", \"status\", 1, \"spinner-border\", \"text-primary\"], [1, \"mt-2\"], [1, \"alert\", \"alert-danger\"], [1, \"alert\", \"alert-info\", \"text-center\"], [\"class\", \"btn btn-primary\", 3, \"click\", 4, \"ngIf\"], [1, \"btn\", \"btn-primary\", 3, \"click\"], [1, \"table-responsive\"], [1, \"table\", \"table-striped\"], [4, \"ngFor\", \"ngForOf\"], [1, \"badge\", 3, \"ngClass\"], [1, \"d-flex\", \"flex-wrap\", 2, \"gap\", \"8px\"], [1, \"btn\", \"btn-sm\", \"btn-info\", 3, \"click\"], [1, \"btn\", \"btn-sm\", \"btn-warning\", 3, \"click\"], [\"class\", \"btn btn-sm btn-danger\", 3, \"click\", 4, \"ngIf\"], [1, \"btn\", \"btn-sm\", \"btn-danger\", 3, \"click\"]],\n        template: function ListComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"h5\", 3);\n            i0.ɵɵtext(4, \"Employees\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(5, ListComponent_button_5_Template, 2, 0, \"button\", 4);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(6, \"div\", 5);\n            i0.ɵɵtemplate(7, ListComponent_div_7_Template, 4, 0, \"div\", 6)(8, ListComponent_div_8_Template, 5, 1, \"div\", 7)(9, ListComponent_div_9_Template, 4, 1, \"div\", 8)(10, ListComponent_div_10_Template, 20, 1, \"div\", 9);\n            i0.ɵɵelementEnd()();\n          }\n          if (rf & 2) {\n            let tmp_0_0;\n            i0.ɵɵadvance(5);\n            i0.ɵɵproperty(\"ngIf\", ((tmp_0_0 = ctx.account()) == null ? null : tmp_0_0.role) === \"Admin\");\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngIf\", ctx.loading);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.error);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.loading && !ctx.error && (ctx.employees == null ? null : ctx.employees.length) === 0);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.loading && !ctx.error && (ctx.employees == null ? null : ctx.employees.length) > 0);\n          }\n        },\n        dependencies: [i5.NgClass, i5.NgForOf, i5.NgIf, i5.DatePipe],\n        encapsulation: 2\n      });\n    }\n  }\n  return ListComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}