import{A as f,Aa as $,Ca as y,D as g,Da as B,E as b,F as m,Fa as z,H as d,Ha as H,I as x,J as w,Ka as E,La as I,Q as D,Y as V,Z as L,_ as S,aa as M,i as h,ia as N,ja as A,ka as F,la as j,m as T,na as O,o as C,p as k,pa as R,q as _,qa as P,r as v,t as a,u as p,v as c,va as q,w as s,y as o,ya as G,z as r}from"./chunk-7XTECHTP.js";var J=t=>({"is-invalid":t});function ee(t,l){t&1&&(o(0,"div",6),f(1,"span",7),d(2," Loading... "),r())}function te(t,l){if(t&1){let e=g();o(0,"div",8),d(1),o(2,"button",9),b("click",function(){_(e);let n=m();return v(n.error="")}),r()()}if(t&2){let e=m();a(),w(" ",e.error," ")}}function ie(t,l){t&1&&(o(0,"div"),d(1,"Name is required"),r())}function ne(t,l){if(t&1&&(o(0,"div",21),c(1,ie,2,0,"div",22),r()),t&2){let e=m(2);a(),s("ngIf",e.f.name.errors.required)}}function re(t,l){t&1&&(o(0,"div"),d(1,"Description is required"),r())}function oe(t,l){if(t&1&&(o(0,"div",21),c(1,re,2,0,"div",22),r()),t&2){let e=m(2);a(),s("ngIf",e.f.description.errors.required)}}function ae(t,l){t&1&&f(0,"span",23)}function se(t,l){if(t&1){let e=g();o(0,"form",10),b("ngSubmit",function(){_(e);let n=m();return v(n.onSubmit())}),o(1,"div",11)(2,"label",12),d(3,"Name"),r(),f(4,"input",13),c(5,ne,2,1,"div",14),r(),o(6,"div",11)(7,"label",12),d(8,"Description"),r(),f(9,"input",15),c(10,oe,2,1,"div",14),r(),o(11,"div",16)(12,"button",17),c(13,ae,1,0,"span",18),d(14," Save "),r(),f(15,"span",19),o(16,"button",20),d(17,"Cancel"),r()()()}if(t&2){let e=m();s("formGroup",e.form),a(4),s("ngClass",D(8,J,e.submitted&&e.f.name.errors)),a(),s("ngIf",e.submitted&&e.f.name.errors),a(4),s("ngClass",D(10,J,e.submitted&&e.f.description.errors)),a(),s("ngIf",e.submitted&&e.f.description.errors),a(2),s("disabled",e.submitting),a(),s("ngIf",e.submitting),a(3),s("disabled",e.submitting)}}var Q=(()=>{class t{constructor(e,i,n,u,W){this.formBuilder=e,this.departmentService=i,this.alertService=n,this.route=u,this.router=W,this.loading=!1,this.submitting=!1,this.submitted=!1,this.error=""}ngOnInit(){this.id=this.route.snapshot.params.id,this.isAddMode=!this.id,this.form=this.formBuilder.group({name:["",A.required],description:["",A.required]}),this.isAddMode||(this.loading=!0,this.departmentService.getById(this.id).pipe(h()).subscribe({next:e=>{this.form.patchValue(e),this.loading=!1},error:e=>{this.error="Error loading department data",this.alertService.error(this.error),this.loading=!1,console.error("Error loading department:",e)}}))}get f(){return this.form.controls}onSubmit(){if(this.submitted=!0,this.error="",this.alertService.clear(),this.form.invalid)return;this.submitting=!0;let e={name:this.form.value.name,description:this.form.value.description};console.log("Submitting department:",e),this.isAddMode?this.createDepartment(e):this.updateDepartment(e)}createDepartment(e){this.departmentService.create(e).pipe(h()).subscribe({next:()=>{this.alertService.success("Department added successfully",{keepAfterRouteChange:!0}),this.router.navigate(["../"],{relativeTo:this.route})},error:i=>{this.error=i?.message||"Error adding department",this.alertService.error(this.error),this.submitting=!1,console.error("Error creating department:",i)}})}updateDepartment(e){this.departmentService.update(this.id,e).pipe(h()).subscribe({next:()=>{this.alertService.success("Department updated successfully",{keepAfterRouteChange:!0}),this.router.navigate(["../../"],{relativeTo:this.route})},error:i=>{this.error=i?.message||"Error updating department",this.alertService.error(this.error),this.submitting=!1,console.error("Error updating department:",i)}})}static{this.\u0275fac=function(i){return new(i||t)(p(q),p(I),p(E),p($),p(y))}}static{this.\u0275cmp=C({type:t,selectors:[["app-add-edit"]],decls:7,vars:4,consts:[[1,"card"],[1,"card-header"],[1,"card-body"],["class","text-center",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[1,"text-center"],[1,"spinner-border","spinner-border-sm"],[1,"alert","alert-danger"],["type","button",1,"btn-close","float-end",3,"click"],[3,"ngSubmit","formGroup"],[1,"mb-3"],[1,"form-label"],["type","text","formControlName","name",1,"form-control",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["type","text","formControlName","description",1,"form-control",3,"ngClass"],[1,"text-center","mt-4"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm me-1",4,"ngIf"],[2,"display","inline-block","width","10px"],["type","button","routerLink","/admin/departments",1,"btn","btn-secondary",3,"disabled"],[1,"invalid-feedback"],[4,"ngIf"],[1,"spinner-border","spinner-border-sm","me-1"]],template:function(i,n){i&1&&(o(0,"div",0)(1,"h5",1),d(2),r(),o(3,"div",2),c(4,ee,3,0,"div",3)(5,te,3,1,"div",4)(6,se,18,12,"form",5),r()()),i&2&&(a(2),x(n.isAddMode?"Add Department":"Edit Department"),a(2),s("ngIf",n.loading),a(),s("ngIf",n.error),a(),s("ngIf",!n.loading))},dependencies:[V,S,O,N,F,j,R,P,B],styles:[`.invalid-feedback[_ngcontent-%COMP%] {
        display: block;
        width: 100%;
        margin-top: 0.25rem;
        font-size: 80%;
        color: #dc3545;
    }
    
    .is-invalid[_ngcontent-%COMP%] {
        border-color: #dc3545;
    }
    
    .text-danger[_ngcontent-%COMP%] {
        color: #dc3545;
    }
    
    .btn-close[_ngcontent-%COMP%] {
        background: transparent;
        border: 0;
        font-size: 1.5rem;
        padding: 0.25rem;
        cursor: pointer;
        opacity: 0.5;
    }
    
    .btn-close[_ngcontent-%COMP%]:hover {
        opacity: 1;
    }
    
    .float-end[_ngcontent-%COMP%] {
        float: right;
    }`]})}}return t})();function de(t,l){if(t&1){let e=g();o(0,"button",8),b("click",function(){_(e);let n=m();return v(n.add())}),d(1,"Add Department"),r()}}function le(t,l){t&1&&(o(0,"div",9),f(1,"span",10),d(2," Loading departments... "),r())}function me(t,l){if(t&1){let e=g();o(0,"div",9)(1,"div",11),d(2),r(),o(3,"button",12),b("click",function(){_(e);let n=m();return v(n.retry())}),d(4,"Retry"),r()()}if(t&2){let e=m();a(2),x(e.error)}}function ce(t,l){if(t&1){let e=g();o(0,"button",8),b("click",function(){_(e);let n=m(2);return v(n.add())}),d(1,"Create First Department"),r()}}function pe(t,l){if(t&1&&(o(0,"div",9)(1,"p"),d(2,"No departments found"),r(),c(3,ce,2,0,"button",4),r()),t&2){let e,i=m();a(3),s("ngIf",((e=i.account())==null?null:e.role)==="Admin")}}function ue(t,l){t&1&&f(0,"span",10)}function fe(t,l){t&1&&(o(0,"span"),d(1,"Edit"),r())}function _e(t,l){t&1&&f(0,"span",10)}function ve(t,l){t&1&&(o(0,"span"),d(1,"Delete"),r())}function ge(t,l){if(t&1){let e=g();o(0,"button",21),b("click",function(){_(e);let n=m().$implicit,u=m(2);return v(u.delete(n.id.toString()))}),c(1,_e,1,0,"span",18)(2,ve,2,0,"span",19),r()}if(t&2){let e=m().$implicit;s("disabled",e.isDeleting),a(),s("ngIf",e.isDeleting),a(),s("ngIf",!e.isDeleting)}}function be(t,l){if(t&1){let e=g();o(0,"tr")(1,"td"),d(2),r(),o(3,"td"),d(4),r(),o(5,"td"),d(6),r(),o(7,"td")(8,"div",16)(9,"button",17),b("click",function(){let n=_(e).$implicit,u=m(2);return v(u.edit(n.id.toString()))}),c(10,ue,1,0,"span",18)(11,fe,2,0,"span",19),r(),c(12,ge,3,3,"button",20),r()()()}if(t&2){let e,i=l.$implicit,n=m(2);a(2),x(i.name),a(2),x(i.description),a(2),x(i.employeeCount),a(4),s("ngIf",i.isDeleting),a(),s("ngIf",!i.isDeleting),a(),s("ngIf",((e=n.account())==null?null:e.role)==="Admin")}}function he(t,l){if(t&1&&(o(0,"div",13)(1,"table",14)(2,"thead")(3,"tr")(4,"th"),d(5,"Name"),r(),o(6,"th"),d(7,"Description"),r(),o(8,"th"),d(9,"Employee Count"),r(),o(10,"th"),d(11,"Actions"),r()()(),o(12,"tbody"),c(13,be,13,6,"tr",15),r()()()),t&2){let e=m();a(13),s("ngForOf",e.departments)}}var U=(()=>{class t{constructor(e,i,n,u){this.router=e,this.departmentService=i,this.accountService=n,this.alertService=u,this.departments=[],this.loading=!1,this.deleting=!1,this.error=""}ngOnInit(){this.fetchDepartments()}fetchDepartments(){this.loading=!0,this.error="",this.departmentService.getAll().pipe(h()).subscribe({next:e=>{this.departments=e,this.loading=!1},error:e=>{this.error="Failed to load departments. Please try again later.",this.alertService.error(this.error),this.loading=!1,console.error(e)}})}account(){return this.accountService.accountValue}edit(e){this.router.navigate(["/admin/departments/add-edit",{id:e}])}delete(e){let i=this.departments.find(n=>n.id===parseInt(e));i&&confirm(`Are you sure you want to delete department "${i.name}"?`)&&(this.deleting=!0,i.isDeleting=!0,this.departmentService.delete(e).pipe(h()).subscribe({next:()=>{this.departments=this.departments.filter(n=>n.id!==parseInt(e)),this.alertService.success("Department deleted successfully",{keepAfterRouteChange:!0}),this.deleting=!1},error:n=>{this.alertService.error("Error deleting department"),i.isDeleting=!1,this.deleting=!1,console.error(n)}}))}add(){this.router.navigate(["/admin/departments/add-edit"])}retry(){this.fetchDepartments()}static{this.\u0275fac=function(i){return new(i||t)(p(y),p(I),p(H),p(E))}}static{this.\u0275cmp=C({type:t,selectors:[["app-list"]],decls:11,vars:5,consts:[[1,"card"],[1,"card-header"],[1,"d-flex","justify-content-between","align-items-center"],[1,"mb-0"],["class","btn btn-sm btn-primary",3,"click",4,"ngIf"],[1,"card-body"],["class","text-center p-3",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"btn","btn-sm","btn-primary",3,"click"],[1,"text-center","p-3"],[1,"spinner-border","spinner-border-sm"],[1,"alert","alert-danger"],[1,"btn","btn-primary",3,"click"],[1,"table-responsive"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],[1,"d-flex",2,"gap","8px"],[1,"btn","btn-sm","btn-primary","me-2",3,"click"],["class","spinner-border spinner-border-sm",4,"ngIf"],[4,"ngIf"],["class","btn btn-sm btn-danger",3,"disabled","click",4,"ngIf"],[1,"btn","btn-sm","btn-danger",3,"click","disabled"]],template:function(i,n){if(i&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"h5",3),d(4,"Departments"),r(),c(5,de,2,0,"button",4),r()(),o(6,"div",5),c(7,le,3,0,"div",6)(8,me,5,1,"div",6)(9,pe,4,1,"div",6)(10,he,14,1,"div",7),r()()),i&2){let u;a(5),s("ngIf",((u=n.account())==null?null:u.role)==="Admin"),a(2),s("ngIf",n.loading),a(),s("ngIf",!n.loading&&n.error),a(),s("ngIf",!n.loading&&!n.error&&n.departments.length===0),a(),s("ngIf",!n.loading&&!n.error&&n.departments.length>0)}},dependencies:[L,S],encapsulation:2})}}return t})();var xe=[{path:"",component:U},{path:"add-edit",component:Q}],Le=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=k({type:t})}static{this.\u0275inj=T({imports:[M,G,z.forChild(xe)]})}}return t})();export{Le as DepartmentsModule};
