import{e as Z}from"./chunk-6FRQHW3F.js";import{A as c,Aa as X,Ca as Y,D as P,Da as T,E as x,F as p,Fa as M,G as R,H as o,Ha as w,I as A,K as j,Ka as N,Q as g,Y as y,Z as D,_ as I,aa as V,i as v,ia as O,ja as u,ka as U,la as $,m as b,na as B,o as E,p as C,pa as G,q as F,qa as z,r as q,ra as H,sa as J,t as a,ta as K,u as f,v as m,w as s,wa as Q,y as n,ya as W,z as t}from"./chunk-7XTECHTP.js";function oe(e,d){e&1&&(n(0,"span",13),c(1,"i",14),o(2," Active "),t())}function ae(e,d){e&1&&(n(0,"span",15),c(1,"i",16),o(2," Deactivated "),t())}function se(e,d){if(e&1&&(n(0,"span"),m(1,oe,3,0,"span",11)(2,ae,3,0,"span",12),t()),e&2){let i=p().$implicit;a(),s("ngIf",i.isActive),a(),s("ngIf",!i.isActive)}}function de(e,d){e&1&&(n(0,"span",17),o(1,"N/A"),t())}function le(e,d){e&1&&c(0,"span",20)}function me(e,d){if(e&1&&(n(0,"span"),o(1),t()),e&2){let i=p(2).$implicit;a(),A(i.isActive?"Deactivate":"Activate")}}function ce(e,d){if(e&1){let i=P();n(0,"button",18),x("click",function(){F(i);let r=p().$implicit,h=p();return q(h.toggleAccountStatus(r.id))}),m(1,le,1,0,"span",19)(2,me,2,1,"span",6),t()}if(e&2){let i=p().$implicit;s("disabled",i.isToggling)("ngClass",i.isActive?"btn-danger":"btn-success"),a(),s("ngIf",i.isToggling),a(),s("ngIf",!i.isToggling)}}function pe(e,d){if(e&1&&(n(0,"tr")(1,"td"),o(2),t(),n(3,"td"),o(4),t(),n(5,"td"),o(6),t(),n(7,"td"),m(8,se,3,2,"span",6)(9,de,2,0,"span",7),t(),n(10,"td",8)(11,"a",9),o(12,"Edit"),t(),m(13,ce,3,4,"button",10),t()()),e&2){let i=d.$implicit;a(2),j("",i.firstName," ",i.lastName,""),a(2),A(i.email),a(2),A(i.role),a(2),s("ngIf",i.role!=="Admin"),a(),s("ngIf",i.role==="Admin"),a(2),R("routerLink","edit/",i.id,""),a(2),s("ngIf",i.role!=="Admin")}}function ue(e,d){e&1&&(n(0,"tr")(1,"td",21),c(2,"span",22),t()())}var ee=(()=>{class e{constructor(i,l){this.accountService=i,this.alertService=l,this.loading=!1}ngOnInit(){this.loading=!0,this.accountService.getAll().pipe(v()).subscribe({next:i=>{this.accounts=i,this.loading=!1},error:i=>{this.alertService.error("Error loading accounts: "+(i?.message||"Unknown error")),this.loading=!1}})}deleteAccount(i){let l=this.accounts.find(r=>r.id===i);l.isDeleting=!0,this.accountService.delete(i).pipe(v()).subscribe({next:()=>{this.accounts=this.accounts.filter(r=>r.id!==i),this.alertService.success("Account deleted successfully")},error:r=>{this.alertService.error("Error deleting account: "+(r?.message||"Unknown error")),l.isDeleting=!1}})}toggleAccountStatus(i){let l=this.accounts.find(S=>S.id===i);if(l.role==="Admin"){this.alertService.error("Cannot change status of admin accounts");return}l.isToggling=!0;let r=!l.isActive,h=r?"activated":"deactivated";this.accountService.updateStatus(i,r).pipe(v()).subscribe({next:S=>{l.isActive=r,this.alertService.success(`Account ${h} successfully`),r?this.alertService.info("User can now log in to the system"):this.alertService.warn("User has been blocked from logging in")},error:S=>{this.alertService.error(`Error updating account status: ${S?.message||"Server error occurred"}`)},complete:()=>{l.isToggling=!1}})}static{this.\u0275fac=function(l){return new(l||e)(f(w),f(N))}}static{this.\u0275cmp=E({type:e,selectors:[["ng-component"]],decls:21,vars:2,consts:[["routerLink","add",1,"btn","btn-sn","btn-success","mb-2"],[1,"table","table-striped"],[2,"width","25%"],[2,"width","20%"],[2,"width","15%"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","text-muted",4,"ngIf"],[2,"white-space","nowrap"],[1,"btn","btn-sm","btn-primary","mr-1",3,"routerLink"],["class","btn btn-sm mr-1",3,"disabled","ngClass","click",4,"ngIf"],["class","badge badge-pill badge-success py-1 px-2",4,"ngIf"],["class","badge badge-pill badge-danger py-1 px-2",4,"ngIf"],[1,"badge","badge-pill","badge-success","py-1","px-2"],[1,"fas","fa-check-circle","mr-1"],[1,"badge","badge-pill","badge-danger","py-1","px-2"],[1,"fas","fa-times-circle","mr-1"],[1,"text-muted"],[1,"btn","btn-sm","mr-1",3,"click","disabled","ngClass"],["class","spinner-border spinner-border-sm",4,"ngIf"],[1,"spinner-border","spinner-border-sm"],["colspan","5",1,"text-center"],[1,"spinner-border","spinner-border-lg","align-center"]],template:function(l,r){l&1&&(n(0,"h1"),o(1,"Account"),t(),n(2,"p"),o(3,"All accounts from secure (admin only) api end point:"),t(),n(4,"a",0),o(5,"Create Account"),t(),n(6,"table",1)(7,"thead")(8,"tr")(9,"th",2),o(10,"Name"),t(),n(11,"th",2),o(12,"Email"),t(),n(13,"th",3),o(14,"Role"),t(),n(15,"th",4),o(16,"Status"),t(),c(17,"th",4),t()(),n(18,"tbody"),m(19,pe,14,9,"tr",5)(20,ue,3,0,"tr",6),t()()),l&2&&(a(19),s("ngForOf",r.accounts),a(),s("ngIf",!r.accounts))},dependencies:[y,D,I,T],encapsulation:2})}}return e})();var _=e=>({"is-invalid":e});function fe(e,d){e&1&&(n(0,"h1"),o(1,"Create Account"),t())}function ve(e,d){e&1&&(n(0,"h1"),o(1,"Edit Account"),t())}function ge(e,d){e&1&&(n(0,"div"),o(1,"Title is required"),t())}function _e(e,d){if(e&1&&(n(0,"div",25),m(1,ge,2,0,"div",0),t()),e&2){let i=p();a(),s("ngIf",i.f.title.errors.required)}}function he(e,d){e&1&&(n(0,"div"),o(1,"First Name is required"),t())}function Se(e,d){if(e&1&&(n(0,"div",25),m(1,he,2,0,"div",0),t()),e&2){let i=p();a(),s("ngIf",i.f.firstName.errors.required)}}function be(e,d){e&1&&(n(0,"div"),o(1,"Last Name is required"),t())}function Ee(e,d){if(e&1&&(n(0,"div",25),m(1,be,2,0,"div",0),t()),e&2){let i=p();a(),s("ngIf",i.f.lastName.errors.required)}}function Ce(e,d){e&1&&(n(0,"div"),o(1,"Email is required"),t())}function xe(e,d){e&1&&(n(0,"div"),o(1,"Email must be a valid email address"),t())}function Ae(e,d){if(e&1&&(n(0,"div",25),m(1,Ce,2,0,"div",0)(2,xe,2,0,"div",0),t()),e&2){let i=p();a(),s("ngIf",i.f.email.errors.required),a(),s("ngIf",i.f.email.errors.email)}}function ye(e,d){e&1&&(n(0,"div"),o(1,"Role is required"),t())}function Ie(e,d){if(e&1&&(n(0,"div",25),m(1,ye,2,0,"div",0),t()),e&2){let i=p();a(),s("ngIf",i.f.role.errors.required)}}function Te(e,d){e&1&&(n(0,"div")(1,"h3",26),o(2,"Change Password"),t(),n(3,"p"),o(4,"Leave Blank to keep the same password"),t()())}function we(e,d){e&1&&(n(0,"div"),o(1,"Password is required"),t())}function Ne(e,d){e&1&&(n(0,"div"),o(1,"Password must be at least 6 characters"),t())}function Me(e,d){if(e&1&&(n(0,"div",25),m(1,we,2,0,"div",0)(2,Ne,2,0,"div",0),t()),e&2){let i=p();a(),s("ngIf",i.f.password.errors.required),a(),s("ngIf",i.f.password.errors.minlength)}}function Le(e,d){e&1&&(n(0,"div"),o(1,"Confirm Password is required"),t())}function ke(e,d){e&1&&(n(0,"div"),o(1,"Passwords must match"),t())}function Fe(e,d){if(e&1&&(n(0,"div",25),m(1,Le,2,0,"div",0)(2,ke,2,0,"div",0),t()),e&2){let i=p();a(),s("ngIf",i.f.confirmPassword.errors.required),a(),s("ngIf",i.f.confirmPassword.errors.mustMatch)}}function qe(e,d){e&1&&c(0,"span",27)}var k=(()=>{class e{constructor(i,l,r,h,S){this.formBuilder=i,this.route=l,this.router=r,this.accountService=h,this.alertService=S,this.loading=!1,this.submitted=!1}ngOnInit(){this.id=this.route.snapshot.params.id,this.isAddMode=!this.id,this.form=this.formBuilder.group({title:["",u.required],firstName:["",u.required],lastName:["",u.required],email:["",[u.required,u.email]],role:["",u.required],password:["",[u.minLength(6),this.isAddMode?u.required:u.nullValidator]],confirmPassword:[""]},{validator:Z("password","confirmPassword")}),this.isAddMode||this.accountService.getById(this.id).pipe(v()).subscribe(i=>this.form.patchValue(i))}get f(){return this.form.controls}onSubmit(){this.submitted=!0,this.alertService.clear(),!this.form.invalid&&(this.loading=!0,this.isAddMode?this.createAccount():this.updateAccount())}createAccount(){this.accountService.create(this.form.value).pipe(v()).subscribe({next:()=>{this.alertService.success("Account created successfully",{keepAfterRouteChange:!0}),this.router.navigate(["../"],{relativeTo:this.route})},error:i=>{this.alertService.error(i),this.loading=!1}})}updateAccount(){this.accountService.update(this.id,this.form.value).pipe(v()).subscribe({next:()=>{this.alertService.success("Account updated successfully",{keepAfterRouteChange:!0}),this.router.navigate(["../"],{relativeTo:this.route})},error:i=>{this.alertService.error(i),this.loading=!1}})}static{this.\u0275fac=function(l){return new(l||e)(f(Q),f(X),f(Y),f(w),f(N))}}static{this.\u0275cmp=E({type:e,selectors:[["ng-component"]],decls:62,vars:34,consts:[[4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"form-row"],[1,"form-group","col"],["formControlName","title",1,"form-control",3,"ngClass"],["value",""],["value","Mr"],["value","Mrs"],["value","Miss"],["value","Ms"],["class","invalid-feedback",4,"ngIf"],[1,"form-group","col-5"],["type","text","formControlName","firstName",1,"form-control",3,"ngClass"],["type","text","formControlName","lastName",1,"form-control",3,"ngClass"],[1,"form-group","col-7"],["type","text","formControlName","email",1,"form-control",3,"ngClass"],["formControlName","role",1,"form-control",3,"ngClass"],["value","User"],["value","Admin"],["type","password","formControlName","password",1,"form-control",3,"ngClass"],["type","password","formControlName","confirmPassword",1,"form-control",3,"ngClass"],[1,"form-group"],[1,"btn","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm mr-1",4,"ngIf"],["routerLink","/admin/accounts",1,"btn","btn-link"],[1,"invalid-feedback"],[1,"pt-3"],[1,"spinner-border","spinner-border-sm","mr-1"]],template:function(l,r){l&1&&(m(0,fe,2,0,"h1",0)(1,ve,2,0,"h1",0),n(2,"form",1),x("ngSubmit",function(){return r.onSubmit()}),n(3,"div",2)(4,"div",3)(5,"label"),o(6,"Title"),t(),n(7,"select",4),c(8,"option",5),n(9,"option",6),o(10,"Mr"),t(),n(11,"option",7),o(12,"Mrs"),t(),n(13,"option",8),o(14,"Miss"),t(),n(15,"option",9),o(16,"Ms"),t()(),m(17,_e,2,1,"div",10),t(),n(18,"div",11)(19,"label"),o(20,"First Name"),t(),c(21,"input",12),m(22,Se,2,1,"div",10),t(),n(23,"div",11)(24,"label"),o(25,"Last Name"),t(),c(26,"input",13),m(27,Ee,2,1,"div",10),t()(),n(28,"div",2)(29,"div",14)(30,"label"),o(31,"Email"),t(),c(32,"input",15),m(33,Ae,3,2,"div",10),t(),n(34,"div",3)(35,"label"),o(36,"Role"),t(),n(37,"select",16),c(38,"option",5),n(39,"option",17),o(40,"User"),t(),n(41,"option",18),o(42,"Admin"),t()(),m(43,Ie,2,1,"div",10),t()(),m(44,Te,5,0,"div",0),n(45,"div",2)(46,"div",3)(47,"label"),o(48,"Password"),t(),c(49,"input",19),m(50,Me,3,2,"div",10),t(),n(51,"div",3)(52,"label"),o(53,"Confirm Password"),t(),c(54,"input",20),m(55,Fe,3,2,"div",10),t()(),n(56,"div",21)(57,"button",22),m(58,qe,1,0,"span",23),o(59," Save "),t(),n(60,"a",24),o(61,"Cancel"),t()()()),l&2&&(s("ngIf",r.isAddMode),a(),s("ngIf",!r.isAddMode),a(),s("formGroup",r.form),a(5),s("ngClass",g(20,_,r.submitted&&r.f.title.errors)),a(10),s("ngIf",r.submitted&&r.f.title.errors),a(4),s("ngClass",g(22,_,r.submitted&&r.f.firstName.errors)),a(),s("ngIf",r.submitted&&r.f.firstName.errors),a(4),s("ngClass",g(24,_,r.submitted&&r.f.lastName.errors)),a(),s("ngIf",r.submitted&&r.f.lastName.errors),a(5),s("ngClass",g(26,_,r.submitted&&r.f.email.errors)),a(),s("ngIf",r.submitted&&r.f.email.errors),a(4),s("ngClass",g(28,_,r.submitted&&r.f.role.errors)),a(6),s("ngIf",r.submitted&&r.f.role.errors),a(),s("ngIf",!r.isAddMode),a(5),s("ngClass",g(30,_,r.submitted&&r.f.password.errors)),a(),s("ngIf",r.submitted&&r.f.password.errors),a(4),s("ngClass",g(32,_,r.submitted&&r.f.confirmPassword.errors)),a(),s("ngIf",r.submitted&&r.f.confirmPassword.errors),a(2),s("disabled",r.loading),a(),s("ngIf",r.loading))},dependencies:[y,I,B,J,K,O,H,U,$,G,z,T],encapsulation:2})}}return e})();var Pe=[{path:"",component:ee},{path:"add",component:k},{path:"edit/:id",component:k}],te=(()=>{class e{static{this.\u0275fac=function(l){return new(l||e)}}static{this.\u0275mod=C({type:e})}static{this.\u0275inj=b({imports:[M.forChild(Pe),M]})}}return e})();var et=(()=>{class e{static{this.\u0275fac=function(l){return new(l||e)}}static{this.\u0275mod=C({type:e})}static{this.\u0275inj=b({imports:[V,W,te]})}}return e})();export{et as AccountsModule};
