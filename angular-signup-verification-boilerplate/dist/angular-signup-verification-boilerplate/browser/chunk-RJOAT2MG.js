import{A as S,Aa as T,B as E,C,Ca as V,D as v,E as _,F as m,H as o,Ha as $,I as y,J as F,K as k,Ka as N,Na as j,Oa as D,T as L,Y as w,Z as A,_ as R,c as I,e as x,g as q,i as f,o as b,q as g,r as h,t as l,u,v as p,w as d,y as r,z as s}from"./chunk-7XTECHTP.js";var M=(n,a,t,i)=>({"bg-warning":n,"bg-success":a,"bg-danger":t,"bg-info":i});function U(n,a){n&1&&(r(0,"div",10),S(1,"div",11),r(2,"p",12),o(3,"Loading requests..."),s()())}function B(n,a){if(n&1){let t=v();r(0,"div",13)(1,"p"),o(2),s(),r(3,"button",4),_("click",function(){g(t);let e=m();return h(e.retry())}),o(4,"Retry"),s()()}if(n&2){let t=m();l(2),y(t.error)}}function J(n,a){if(n&1){let t=v();r(0,"div",14)(1,"p"),o(2,"No requests found. Click the button below to add a request."),s(),r(3,"button",15),_("click",function(){g(t);let e=m();return h(e.add())}),o(4,"Add Request"),s()()}}function z(n,a){if(n&1&&(r(0,"div",25),o(1),s()),n&2){let t=a.$implicit;l(),k(" ",t.name," (x",t.quantity,") ")}}function G(n,a){if(n&1&&(E(0),p(1,z,2,2,"div",24),C()),n&2){let t=m().$implicit;l(),d("ngForOf",t.requestItems)}}function H(n,a){n&1&&(r(0,"div",26),o(1," No items "),s())}function K(n,a){if(n&1){let t=v();r(0,"button",27),_("click",function(){g(t);let e=m().$implicit,c=m(2);return h(c.delete(e.id))}),o(1,"Delete"),s()}}function Q(n,a){if(n&1){let t=v();r(0,"tr")(1,"td"),o(2),s(),r(3,"td"),o(4),s(),r(5,"td"),p(6,G,2,1,"ng-container",19)(7,H,2,0,"div",20),s(),r(8,"td")(9,"span",21),o(10),s()(),r(11,"td")(12,"div",22)(13,"button",4),_("click",function(){let e=g(t).$implicit,c=m(2);return h(c.edit(e.id))}),o(14,"Edit"),s(),p(15,K,2,0,"button",23),s()()()}if(n&2){let t,i=a.$implicit,e=m(2);l(2),y(i.type),l(2),y(e.getEmployeeInfo(i.employeeId)),l(2),d("ngIf",i.requestItems&&i.requestItems.length>0),l(),d("ngIf",!i.requestItems||i.requestItems.length===0),l(2),d("ngClass",L(7,M,i.status==="Pending",i.status==="Approved",i.status==="Rejected",i.status==="Completed")),l(),y(i.status),l(5),d("ngIf",((t=e.account())==null?null:t.role)==="Admin")}}function W(n,a){if(n&1&&(r(0,"div",16)(1,"table",17)(2,"thead")(3,"tr")(4,"th"),o(5,"Type"),s(),r(6,"th"),o(7,"Employee"),s(),r(8,"th"),o(9,"Items"),s(),r(10,"th"),o(11,"Status"),s(),r(12,"th"),o(13,"Actions"),s()()(),r(14,"tbody"),p(15,Q,16,12,"tr",18),s()()()),n&2){let t=m();l(15),d("ngForOf",t.requests)}}var ne=(()=>{class n{constructor(t,i,e,c,O,P){this.requestService=t,this.accountService=i,this.employeeService=e,this.alertService=c,this.router=O,this.route=P,this.requests=[],this.employees=[],this.accounts=[],this.loading=!1,this.error="",this.employeeIdFilter=null,this.retryAttempts=0,this.maxRetryAttempts=2}ngOnInit(){this.loading=!0,this.route.queryParams.subscribe(t=>{t.employeeId&&(this.employeeIdFilter=t.employeeId,console.log(`Filtering requests for employee ID: ${this.employeeIdFilter}`))}),x({employees:this.employeeService.getAll().pipe(f(),q(t=>(console.error("Error loading employees:",t),I([])))),accounts:this.accountService.getAll().pipe(f(),q(t=>(console.error("Error loading accounts:",t),I([]))))}).subscribe({next:t=>{this.employees=t.employees||[],this.accounts=t.accounts||[],console.log("Loaded employees:",this.employees.length),console.log("Loaded accounts:",this.accounts.length),this.loadRequests()},error:t=>{console.error("Error loading reference data:",t),this.loadRequests()}})}loadRequests(){this.loading=!0,this.error="",(this.employeeIdFilter?this.requestService.getByEmployee(Number(this.employeeIdFilter)):this.requestService.getAll()).pipe(f()).subscribe({next:i=>{this.requests=i||[],this.requests=this.requests.map(e=>(e.RequestItems&&!e.requestItems?e.requestItems=e.RequestItems:e.requestItems||(e.requestItems=[]),e)),console.log(`Loaded ${this.requests.length} requests with items:`,this.requests.map(e=>({id:e.id,items:e.requestItems?.length||0}))),this.loading=!1},error:i=>{console.error("Error loading requests:",i),this.error="Failed to load requests",this.loading=!1,this.requests.length===0&&this.loadMockData()}})}loadMockData(){console.log("Loading mock request data as fallback"),this.requests=[{id:1,employeeId:this.employeeIdFilter?Number(this.employeeIdFilter):1,type:"Equipment",status:"Pending",requestItems:[{id:1,name:"Laptop",quantity:1},{id:2,name:"Monitor",quantity:2}]},{id:2,employeeId:this.employeeIdFilter?Number(this.employeeIdFilter):2,type:"Office Supplies",status:"Approved",requestItems:[{id:3,name:"Notebooks",quantity:5},{id:4,name:"Pens",quantity:10}]}],this.loading=!1,this.error="Using sample data - API connection failed"}getEmployeeInfo(t){if(!t)return"Unknown";let i=this.employees.find(e=>e.id===t);if(i){let e=this.accounts.find(c=>c.id===i.userId);if(e){let c=e.role==="Admin"?"Admin User":"Normal User";return`${e.email} (${c})`}return`${i.employeeId}`}return`Employee ID: ${t}`}account(){return this.accountService.accountValue}add(){this.employeeIdFilter?this.router.navigate(["/admin/requests/add"],{queryParams:{employeeId:this.employeeIdFilter}}):this.router.navigate(["/admin/requests/add"])}edit(t){this.router.navigate(["/admin/requests/edit",t])}delete(t){this.requests.find(e=>e.id===t)&&confirm("Are you sure you want to delete this request?")&&this.requestService.delete(t.toString()).pipe(f()).subscribe({next:()=>{this.alertService.success("Request deleted successfully"),this.requests=this.requests.filter(e=>e.id!==t)},error:e=>{this.alertService.error("Error deleting request"),console.error("Error deleting request:",e)}})}retry(){this.error="",this.retryAttempts++,this.loadRequests()}static{this.\u0275fac=function(i){return new(i||n)(u(D),u($),u(j),u(N),u(V),u(T))}}static{this.\u0275cmp=b({type:n,selectors:[["ng-component"]],decls:12,vars:5,consts:[[1,"card"],[1,"card-header"],[1,"d-flex","justify-content-between","align-items-center"],[1,"mb-0"],[1,"btn","btn-sm","btn-primary",3,"click"],[1,"card-body"],["class","text-center my-3",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["class","alert alert-info text-center",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"text-center","my-3"],["role","status",1,"spinner-border","text-primary"],[1,"mt-2"],[1,"alert","alert-danger"],[1,"alert","alert-info","text-center"],[1,"btn","btn-primary",3,"click"],[1,"table-responsive"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"badge",3,"ngClass"],[1,"d-flex","flex-wrap",2,"gap","8px"],["class","btn btn-sm btn-danger",3,"click",4,"ngIf"],["class","mb-1",4,"ngFor","ngForOf"],[1,"mb-1"],[1,"text-muted"],[1,"btn","btn-sm","btn-danger",3,"click"]],template:function(i,e){i&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h5",3),o(4),s(),r(5,"button",4),_("click",function(){return e.add()}),o(6,"Add Request"),s()()(),r(7,"div",5),p(8,U,4,0,"div",6)(9,B,5,1,"div",7)(10,J,5,0,"div",8)(11,W,16,1,"div",9),s()()),i&2&&(l(4),F("Requests ",e.employeeIdFilter?"for Employee "+e.employeeIdFilter:"",""),l(4),d("ngIf",e.loading),l(),d("ngIf",e.error),l(),d("ngIf",!e.loading&&!e.error&&(e.requests==null?null:e.requests.length)===0),l(),d("ngIf",!e.loading&&!e.error&&(e.requests==null?null:e.requests.length)>0))},dependencies:[w,A,R],encapsulation:2})}}return n})();export{ne as a};
