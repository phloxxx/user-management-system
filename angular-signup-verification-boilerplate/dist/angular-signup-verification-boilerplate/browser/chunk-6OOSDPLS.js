import{$ as M,A as I,Aa as K,B as x,C as y,Ca as H,D as b,Da as U,E as h,F as p,H as s,Ha as z,I as C,J as _,K as E,Ka as G,M as L,Ma as J,N as T,Na as Q,O as D,P as O,Q as w,S as N,U as j,V as A,Y as F,Z as $,_ as V,f as S,i as f,ka as R,ma as P,o as k,q as g,r as v,ra as q,sa as W,t as n,ta as B,u,v as d,w as l,y as a,z as r}from"./chunk-7XTECHTP.js";var Z=()=>["Onboarding","Transfer"],ee=(t,c,e)=>({"bg-warning":t,"bg-success":c,"bg-danger":e}),te=t=>["/admin/requests/edit",t],ie=t=>({"text-warning":t}),ne=t=>({"text-success":t}),oe=t=>({"text-danger":t});function re(t,c){if(t&1&&(a(0,"span"),s(1),r()),t&2){let e=p();n(),C(e.employeeName)}}function ae(t,c){if(t&1&&(a(0,"span"),s(1),r()),t&2){let e=p();n(),_("ID: ",e.employeeId,"")}}function se(t,c){if(t&1){let e=b();a(0,"button",11),h("click",function(){g(e);let o=p();return v(o.createOnboarding())}),s(1," New Onboarding "),r()}}function le(t,c){t&1&&(a(0,"div",12),I(1,"div",13),r())}function ce(t,c){if(t&1&&(a(0,"div",14),I(1,"i",15),s(2),r()),t&2){let e=p();n(2),_(" ",e.error," ")}}function pe(t,c){t&1&&(a(0,"th"),s(1,"Actions"),r())}function de(t,c){if(t&1&&(x(0),s(1),y()),t&2){let e=p().$implicit;n(),_(" ",e.details.task||"Complete onboarding process"," ")}}function me(t,c){if(t&1&&(x(0),s(1),y()),t&2){let e=p().$implicit;n(),E(" Transfer from ",e.details.from||"Previous"," to ",e.details.to||"New"," department ")}}function _e(t,c){if(t&1&&(a(0,"div",22)(1,"span",23),s(2,"Request ID:"),r(),a(3,"a",24),s(4),r()()),t&2){let e=p(2).$implicit;n(3),l("routerLink",w(2,te,e.details.requestId)),n(),_(" #",e.details.requestId," ")}}function ue(t,c){if(t&1&&(a(0,"span"),s(1),r()),t&2){let e=p().$implicit;n(),_("(x",e.quantity,")")}}function fe(t,c){if(t&1&&(a(0,"li"),s(1),d(2,ue,2,1,"span",3),r()),t&2){let e=c.$implicit;n(),_(" ",e.name," "),n(),l("ngIf",e.quantity)}}function ge(t,c){if(t&1&&(a(0,"div",22)(1,"span",23),s(2,"Items:"),r(),a(3,"ul",25),d(4,fe,3,2,"li",18),r()()),t&2){let e=p(2).$implicit;n(4),l("ngForOf",e.details.items)}}function ve(t,c){if(t&1&&(x(0),d(1,_e,5,4,"div",21)(2,ge,5,1,"div",21),y()),t&2){let e=p().$implicit;n(),l("ngIf",e.details==null?null:e.details.requestId),n(),l("ngIf",e.details==null?null:e.details.items)}}function xe(t,c){if(t&1&&(x(0),s(1),y()),t&2){let e=p().$implicit,i=p(2);n(),_(" ",i.formatDetails(e.details)," ")}}function ye(t,c){t&1&&I(0,"div",31)}function he(t,c){if(t&1){let e=b();a(0,"td")(1,"select",26),D("ngModelChange",function(o){g(e);let m=p().$implicit;return T(m.status,o)||(m.status=o),v(o)}),h("change",function(){g(e);let o=p().$implicit,m=p(2);return v(m.updateStatus(o))}),a(2,"option",27),s(3,"Pending"),r(),a(4,"option",28),s(5,"Approved"),r(),a(6,"option",29),s(7,"Rejected"),r()(),d(8,ye,1,0,"div",30),r()}if(t&2){let e=p().$implicit;n(),L("ngModel",e.status),l("disabled",e.updating),n(),l("ngClass",w(6,ie,e.status==="Pending")),n(2),l("ngClass",w(8,ne,e.status==="Approved")),n(2),l("ngClass",w(10,oe,e.status==="Rejected")),n(2),l("ngIf",e.updating)}}function we(t,c){if(t&1&&(a(0,"tr")(1,"td"),s(2),r(),a(3,"td")(4,"div",19),d(5,de,2,1,"ng-container",3)(6,me,2,2,"ng-container",3)(7,ve,3,2,"ng-container",3)(8,xe,2,1,"ng-container",3),r()(),a(9,"td"),s(10),j(11,"date"),r(),a(12,"td")(13,"span",20),s(14),r()(),d(15,he,9,12,"td",3),r()),t&2){let e,i=c.$implicit,o=p(2);n(2),C(i.type),n(3),l("ngIf",i.type==="Onboarding"),n(),l("ngIf",i.type==="Transfer"),n(),l("ngIf",i.type&&i.type.includes("Request")),n(),l("ngIf",!O(12,Z).includes(i.type)&&!(i.type&&i.type.includes("Request"))),n(2),C(A(11,9,i.createdDate,"short")),n(3),l("ngClass",N(13,ee,i.status==="Pending",i.status==="Approved",i.status==="Rejected")),n(),_(" ",i.status," "),n(),l("ngIf",((e=o.account())==null?null:e.role)==="Admin")}}function Ie(t,c){if(t&1&&(a(0,"div",16)(1,"table",17)(2,"thead")(3,"tr")(4,"th"),s(5,"Type"),r(),a(6,"th"),s(7,"Details"),r(),a(8,"th"),s(9,"Created Date"),r(),a(10,"th"),s(11,"Status"),r(),d(12,pe,2,0,"th",3),r()(),a(13,"tbody"),d(14,we,16,17,"tr",18),r()()()),t&2){let e,i=p();n(12),l("ngIf",((e=i.account())==null?null:e.role)==="Admin"),n(2),l("ngForOf",i.workflows)}}function be(t,c){if(t&1){let e=b();a(0,"div",34)(1,"button",35),h("click",function(){g(e);let o=p(2);return v(o.createOnboarding())}),s(2,"Create Onboarding Workflow"),r()()}}function Ce(t,c){if(t&1&&(a(0,"div",12)(1,"div",32),s(2," No workflows found for this employee. "),d(3,be,3,0,"div",33),r()()),t&2){let e,i=p();n(3),l("ngIf",((e=i.account())==null?null:e.role)==="Admin")}}var Ne=(()=>{class t{constructor(e,i,o,m,X,Y){this.accountService=e,this.workflowService=i,this.employeeService=o,this.route=m,this.router=X,this.alertService=Y,this.workflows=[],this.employeeId=null,this.employeeName="",this.loading=!1,this.error="",this.subscriptions=[]}ngOnInit(){this.route.queryParams.subscribe(i=>{if(i.employeeId)this.employeeId=i.employeeId,this.loadEmployeeDetails(),this.loadWorkflows();else{let o=this.route.snapshot.params.id;o?(this.employeeId=o,this.loadEmployeeDetails(),this.loadWorkflows()):this.error="No employee specified. Please go back and select an employee."}});let e=S(8e3).subscribe(()=>{this.loading&&(console.warn("Loading timeout exceeded"),this.loading=!1,this.workflows.length===0&&(this.showMockData(),this.error="Loading took too long. Showing sample data."))});this.subscriptions.push(e)}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}account(){return this.accountService.accountValue}loadEmployeeDetails(){this.employeeId&&this.employeeService.getById(this.employeeId).pipe(f()).subscribe({next:e=>{e&&(this.employeeName=`${e.employeeId}`)},error:e=>{console.error("Error loading employee details:",e)}})}loadWorkflows(){if(!this.employeeId)return;this.loading=!0,this.error="";let e=parseInt(this.employeeId);isNaN(e)?(this.loading=!1,this.error="Invalid employee ID"):(console.log(`Loading workflows for employee ID: ${e}`),this.workflowService.getByEmployeeId(e).pipe(f()).subscribe({next:i=>{console.log(`Received ${i.length} workflows`),this.workflows=i,this.loading=!1,this.workflows.length===0&&(this.error="No workflows found for this employee.")},error:i=>{console.error("Error loading workflows:",i),this.error="Failed to load workflows. Please try again.",this.loading=!1,this.showMockData()}}))}showMockData(){let e=parseInt(this.employeeId)||1;this.workflows=[{id:100,employeeId:e,type:"Onboarding",details:{task:"Complete orientation and training"},status:"Approved",createdDate:new Date(Date.now()-30*24*60*60*1e3).toISOString()},{id:101,employeeId:e,type:"Transfer",details:{from:"HR",to:"Engineering"},status:"Pending",createdDate:new Date(Date.now()-7*24*60*60*1e3).toISOString()}]}updateStatus(e){e.updating=!0,this.workflowService.updateStatus(e.id,e.status).pipe(f()).subscribe({next:()=>{e.updating=!1,this.alertService.success(`Workflow status updated to ${e.status}`)},error:i=>{e.updating=!1,console.error("Error updating workflow status:",i),this.alertService.error("Failed to update workflow status")}})}formatDetails(e){return e?Array.isArray(e.steps)?e.steps.join(", "):typeof e=="object"?Object.entries(e).map(([i,o])=>`${i}: ${o}`).join(", "):e.toString():""}getFormattedDetailsArray(e){return e?Object.entries(e).map(([i,o])=>({key:i.charAt(0).toUpperCase()+i.slice(1),value:o})):[]}objectIsEmpty(e){return e?Object.keys(e).length===0:!0}back(){this.router.navigate(["/admin/employees"])}createOnboarding(){if(!this.employeeId)return;let e=parseInt(this.employeeId);isNaN(e)||this.workflowService.createOnboarding({employeeId:e}).pipe(f()).subscribe({next:i=>{this.alertService.success("Onboarding workflow created successfully"),this.workflows.unshift(i)},error:i=>{console.error("Error creating onboarding workflow:",i),this.alertService.error("Failed to create onboarding workflow")}})}splitItemsList(e){return e?e.split(",").map(i=>i.trim()):[]}static{this.\u0275fac=function(i){return new(i||t)(u(z),u(J),u(Q),u(K),u(H),u(G))}}static{this.\u0275cmp=k({type:t,selectors:[["ng-component"]],decls:15,vars:7,consts:[[1,"card"],[1,"card-header","d-flex","justify-content-between","align-items-center"],[1,"mb-0"],[4,"ngIf"],["class","btn btn-primary btn-sm",3,"click",4,"ngIf"],[1,"card-body"],["class","text-center p-4",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"mt-3","d-flex","justify-content-end"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-primary","btn-sm",3,"click"],[1,"text-center","p-4"],["role","status",1,"spinner-border","text-primary"],[1,"alert","alert-warning"],[1,"fas","fa-exclamation-triangle","me-2"],[1,"table-responsive"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],[1,"details-container"],[1,"badge",3,"ngClass"],["class","mb-1",4,"ngIf"],[1,"mb-1"],[1,"fw-bold"],[1,"text-primary",3,"routerLink"],[1,"mb-0","ps-3"],[1,"form-select","form-select-sm","border-primary",2,"min-width","120px","cursor","pointer","box-shadow","0 1px 2px rgba(0,0,0,0.1)",3,"ngModelChange","change","ngModel","disabled"],["value","Pending",3,"ngClass"],["value","Approved",3,"ngClass"],["value","Rejected",3,"ngClass"],["class","spinner-border spinner-border-sm text-primary mt-1","role","status",4,"ngIf"],["role","status",1,"spinner-border","spinner-border-sm","text-primary","mt-1"],[1,"alert","alert-info"],["class","mt-3",4,"ngIf"],[1,"mt-3"],[1,"btn","btn-primary",3,"click"]],template:function(i,o){if(i&1&&(a(0,"div",0)(1,"div",1)(2,"h5",2),s(3," Workflows for Employee "),d(4,re,2,1,"span",3)(5,ae,2,1,"span",3),r(),d(6,se,2,0,"button",4),r(),a(7,"div",5),d(8,le,2,0,"div",6)(9,ce,3,1,"div",7)(10,Ie,15,2,"div",8)(11,Ce,4,1,"div",6),a(12,"div",9)(13,"button",10),h("click",function(){return o.back()}),s(14,"Back to Employees"),r()()()()),i&2){let m;n(4),l("ngIf",o.employeeName),n(),l("ngIf",!o.employeeName&&o.employeeId),n(),l("ngIf",((m=o.account())==null?null:m.role)==="Admin"),n(2),l("ngIf",o.loading),n(),l("ngIf",o.error),n(),l("ngIf",!o.loading&&o.workflows.length>0),n(),l("ngIf",!o.loading&&o.workflows.length===0&&!o.error)}},dependencies:[F,$,V,W,B,q,R,P,U,M],encapsulation:2})}}return t})();export{Ne as a};
